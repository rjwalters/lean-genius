/-
Erdős Problem #246: Completeness of {a^k b^l : k, l ≥ 0}

Source: https://erdosproblems.com/246
Status: SOLVED (Birch 1959)

Statement:
Let (a, b) = 1. The set {a^k b^l : k, l ≥ 0} is complete — that is, every
sufficiently large integer is the sum of distinct integers of the form a^k b^l
with k, l ≥ 0.

Answer: YES (Birch 1959)

Background:
A set S ⊆ ℕ is called "complete" if every sufficiently large integer can be
represented as a sum of distinct elements from S. This problem asks about
completeness for sets generated by powers of two coprime integers.

Known Results:
- Birch (1959): Original proof of completeness
- Cassels (1960): More general result covering this as a special case
- Davenport: Still true with l ≤ C(a,b) for some constant
- Hegyvári (2000): Explicit bound, quadruple exponential in a, b
- Fang-Chen (2017): Improved to triply exponential
- Yu (2024): Large n uses elements > n/(log n)^{1+o(1)}

References:
- [Bi59] Birch, "Note on a problem of Erdős"
- [Ca60] Cassels, "On the representation of integers..."
- [He00b] Hegyvári, "On the completeness of an exponential type sequence"
- [FaCh17] Fang-Chen, "A quantitative form of the Erdős-Birch theorem"
- [Yu24] Yu, "On the representation of an exponential type sequence"

Tags: number-theory, complete-sequences, additive-combinatorics, exponential-sequences
-/

import Mathlib.Data.Nat.Basic
import Mathlib.Data.Nat.GCD.Basic
import Mathlib.Data.Finset.Basic
import Mathlib.Algebra.BigOperators.Group.Finset
import Mathlib.Data.Set.Basic

namespace Erdos246

/-!
## Part 1: Basic Definitions
-/

/-- The set of all integers of the form a^k * b^l where k, l ≥ 0 -/
def powerSet (a b : ℕ) : Set ℕ :=
  { n : ℕ | ∃ k l : ℕ, n = a^k * b^l }

/-- Elements of the power set for coprime a, b -/
example : 1 ∈ powerSet 2 3 := ⟨0, 0, by simp [powerSet]⟩
example : 2 ∈ powerSet 2 3 := ⟨1, 0, by simp [powerSet]⟩
example : 3 ∈ powerSet 2 3 := ⟨0, 1, by simp [powerSet]⟩
example : 6 ∈ powerSet 2 3 := ⟨1, 1, by simp [powerSet]⟩

/-- A set S is complete if every sufficiently large n is a sum of
    distinct elements from S -/
def isComplete (S : Set ℕ) : Prop :=
  ∃ N₀ : ℕ, ∀ n ≥ N₀, ∃ T : Finset ℕ,
    (∀ x ∈ T, x ∈ S) ∧
    T.sum id = n

/-- Stronger: S is asymptotically complete with threshold N₀ -/
def isCompleteFrom (S : Set ℕ) (N₀ : ℕ) : Prop :=
  ∀ n ≥ N₀, ∃ T : Finset ℕ,
    (∀ x ∈ T, x ∈ S) ∧
    T.sum id = n

/-!
## Part 2: The Main Theorem (Birch 1959)
-/

/-- Birch's Theorem: For coprime a, b, the power set is complete -/
axiom birch_theorem :
  ∀ a b : ℕ, a ≥ 2 → b ≥ 2 → Nat.Coprime a b →
    isComplete (powerSet a b)

/-- Explicit threshold: there exists N₀ depending on a, b -/
axiom birch_threshold_exists :
  ∀ a b : ℕ, a ≥ 2 → b ≥ 2 → Nat.Coprime a b →
    ∃ N₀ : ℕ, isCompleteFrom (powerSet a b) N₀

/-- The classical case: {2^k · 3^l} is complete -/
theorem two_three_complete : isComplete (powerSet 2 3) := by
  apply birch_theorem
  · norm_num
  · norm_num
  · decide

/-!
## Part 3: Cassels' Generalization
-/

/-- Cassels' more general result (1960) -/
axiom cassels_general :
  ∀ S : Set ℕ, (∃ c > 0, ∀ n ≥ 1, (S ∩ Set.Icc 1 n).ncard ≥ c * Real.log n) →
    isComplete S

/-- Cassels implies Birch -/
theorem cassels_implies_birch :
  ∀ a b : ℕ, a ≥ 2 → b ≥ 2 → Nat.Coprime a b →
    isComplete (powerSet a b) := by
  intro a b _ _ _
  -- Power sets grow at least logarithmically
  sorry

/-!
## Part 4: Davenport's Observation
-/

/-- Power set with bounded l -/
def powerSetBoundedL (a b : ℕ) (L : ℕ) : Set ℕ :=
  { n : ℕ | ∃ k l : ℕ, l ≤ L ∧ n = a^k * b^l }

/-- Davenport: Completeness holds even with bounded l -/
axiom davenport_bounded_l :
  ∀ a b : ℕ, a ≥ 2 → b ≥ 2 → Nat.Coprime a b →
    ∃ L : ℕ, isComplete (powerSetBoundedL a b L)

/-- The bound L depends only on a and b -/
axiom davenport_uniform :
  ∃ f : ℕ → ℕ → ℕ, ∀ a b : ℕ, a ≥ 2 → b ≥ 2 → Nat.Coprime a b →
    isComplete (powerSetBoundedL a b (f a b))

/-!
## Part 5: Quantitative Bounds (Hegyvári, Fang-Chen)
-/

/-- Hegyvári's explicit bound (2000): quadruple exponential -/
axiom hegyvari_bound :
  ∀ a b : ℕ, a ≥ 2 → b ≥ 2 → Nat.Coprime a b →
    ∃ L : ℕ, L ≤ 2^(2^(2^(2^(max a b)))) ∧
    isComplete (powerSetBoundedL a b L)

/-- Fang-Chen improvement (2017): triply exponential -/
axiom fang_chen_bound :
  ∀ a b : ℕ, a ≥ 2 → b ≥ 2 → Nat.Coprime a b →
    ∃ L : ℕ, L ≤ 2^(2^(2^(max a b))) ∧
    isComplete (powerSetBoundedL a b L)

/-!
## Part 6: Yu's Result on Large Summands
-/

/-- Yu (2024): Can use only large elements -/
axiom yu_large_summands :
  ∀ a b : ℕ, a ≥ 2 → b ≥ 2 → Nat.Coprime a b →
    ∃ N₀ : ℕ, ∀ n ≥ N₀, ∃ T : Finset ℕ,
      (∀ x ∈ T, x ∈ powerSet a b) ∧
      (∀ x ∈ T, x > n / (Nat.log n + 1)^2) ∧
      T.sum id = n

/-!
## Part 7: Related Complete Sequences
-/

/-- Fibonacci sequence is complete (Zeckendorf) -/
def fibonacci : ℕ → ℕ
  | 0 => 0
  | 1 => 1
  | n + 2 => fibonacci (n + 1) + fibonacci n

def fibonacciSet : Set ℕ := { n | ∃ k ≥ 2, n = fibonacci k }

axiom zeckendorf_completeness : isComplete fibonacciSet

/-- Powers of 2 are complete (binary representation) -/
def powersOfTwo : Set ℕ := { n | ∃ k : ℕ, n = 2^k }

theorem powers_of_two_complete : isComplete powersOfTwo := by
  use 1
  intro n hn
  -- Binary representation
  sorry

/-- General criterion for completeness -/
axiom completeness_criterion :
  ∀ S : Set ℕ, (1 ∈ S) →
    (∀ N : ℕ, ∃ T : Finset ℕ, (∀ x ∈ T, x ∈ S ∧ x ≤ N) ∧ T.sum id ≥ N + 1) →
    isComplete S

/-!
## Part 8: Non-Complete Sequences
-/

/-- Powers of a single integer (a ≥ 2) are not complete -/
def powersOf (a : ℕ) : Set ℕ := { n | ∃ k : ℕ, n = a^k }

/-- Single base powers are not complete for a ≥ 3 -/
axiom single_powers_not_complete :
  ∀ a : ℕ, a ≥ 3 → ¬ isComplete (powersOf a)

/-- The missing integers form positive density -/
axiom non_representable_density :
  ∀ a : ℕ, a ≥ 3 →
    ∃ c > 0, ∀ N : ℕ, N ≥ 1 →
      (Set.Icc 1 N \ { n | ∃ T : Finset ℕ, (∀ x ∈ T, x ∈ powersOf a) ∧ T.sum id = n }).ncard
        ≥ c * N

/-!
## Part 9: Connection to Problem 254
-/

/-- Problem 254 is related via Cassels' general result -/
axiom problem_254_connection :
  -- Cassels' result covers both Problem 246 and Problem 254
  True

/-!
## Part 10: Structure of Power Sets
-/

/-- Elements up to N in powerSet a b -/
def powerSetUpTo (a b N : ℕ) : Finset ℕ :=
  Finset.filter (· ∈ powerSet a b) (Finset.range (N + 1))

/-- Counting function grows logarithmically -/
axiom power_set_counting :
  ∀ a b : ℕ, a ≥ 2 → b ≥ 2 → Nat.Coprime a b →
    ∃ c₁ c₂ > 0, ∀ N ≥ 2,
      c₁ * (Real.log N)^2 ≤ (powerSetUpTo a b N).card ∧
      (powerSetUpTo a b N).card ≤ c₂ * (Real.log N)^2

/-- The sum of reciprocals diverges slowly -/
axiom reciprocal_sum_bound :
  ∀ a b : ℕ, a ≥ 2 → b ≥ 2 →
    ∃ c > 0, ∀ N ≥ 2,
      (powerSetUpTo a b N).sum (fun x => (1 : ℝ) / x) ≤ c * Real.log N

/-!
## Part 11: Unique Representations
-/

/-- Number of representations of n -/
def numRepresentations (a b n : ℕ) : ℕ :=
  (Finset.filter
    (fun T : Finset ℕ => (∀ x ∈ T, x ∈ powerSet a b) ∧ T.sum id = n)
    (Finset.powerset (powerSetUpTo a b n))).card

/-- Most numbers have few representations -/
axiom sparse_representations :
  ∀ a b : ℕ, a ≥ 2 → b ≥ 2 → Nat.Coprime a b →
    ∃ C : ℕ, ∀ n : ℕ, numRepresentations a b n ≤ C * (Nat.log n + 1)^2

/-!
## Part 12: Algorithmic Aspects
-/

/-- Greedy algorithm for representation -/
def greedyRepresentation (a b : ℕ) (n : ℕ) : List ℕ :=
  -- Takes largest element ≤ remaining sum, repeat
  sorry

/-- Greedy works eventually -/
axiom greedy_eventually_works :
  ∀ a b : ℕ, a ≥ 2 → b ≥ 2 → Nat.Coprime a b →
    ∃ N₀ : ℕ, ∀ n ≥ N₀,
      let result := greedyRepresentation a b n
      (result.sum = n) ∧
      (∀ x ∈ result, x ∈ powerSet a b) ∧
      result.Nodup

/-!
## Part 13: Summary
-/

/-- Main Result: Erdős Problem #246 is SOLVED -/
theorem erdos_246 :
    ∀ a b : ℕ, a ≥ 2 → b ≥ 2 → Nat.Coprime a b →
      isComplete (powerSet a b) :=
  birch_theorem

/-- Summary of the solution -/
theorem erdos_246_summary :
  -- {a^k b^l : k, l ≥ 0} is complete for coprime a, b ≥ 2
  -- Birch (1959): Original proof
  -- Cassels (1960): More general result
  -- Davenport: Works with bounded l
  -- Hegyvári (2000): Quadruple exponential bound on l
  -- Fang-Chen (2017): Triply exponential bound
  -- Yu (2024): Can use only large summands
  True := trivial

/-- The key insight -/
theorem key_insight :
  -- Two coprime bases generate enough elements
  -- The logarithmic density suffices for completeness
  -- Contrast with single-base powers (not complete for base ≥ 3)
  True := trivial

end Erdos246
