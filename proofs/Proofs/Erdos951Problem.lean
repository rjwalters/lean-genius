/-
Erdős Problem #951: Beurling Prime Counting

**Question**: Let 1 < a₁ < a₂ < ⋯ be a sequence of real numbers such that
|∏ᵢ aᵢ^{kᵢ} - ∏ⱼ aⱼ^{ℓⱼ}| ≥ 1
for every distinct pair of non-negative finitely supported integer tuples.
Is it true that #{aᵢ ≤ x} ≤ π(x)?

**Status**: OPEN - This is an unsolved conjecture with no known partial results.

**Context**: This question was posed during an Erdős lecture at Queens College by an
audience member, possibly S. Shapiro. Such sequences are called "Beurling prime numbers."

**Beurling Primes**: A generalized notion where we replace the primes with any increasing
sequence of reals > 1. The "Beurling integers" are then all finite products of these
generalized primes. The study of such systems was initiated by Arne Beurling.

**The Gap Condition**: The requirement that distinct products differ by at least 1 is a
strong "primitive sequence" condition. It ensures that the multiplicative structure
generated by the aᵢ is well-separated.

**Why π(x)?**: The conjecture suggests that even under this strong separation condition,
you cannot have more "generalized primes" up to x than actual primes. This would mean
the true primes are, in some sense, optimally dense among all multiplicatively
well-separated sequences.

**Related Work**:
- Beurling's original work on generalized primes
- Connections to the Prime Number Theorem for Beurling systems
- Related to the theory of primitive sequences

References:
- https://erdosproblems.com/951
- [Er77c] Erdős "...series and number theory" lectures (1977)
-/

import Mathlib

namespace Erdos951

open Nat Finset BigOperators

/-
## Beurling Prime Systems

We formalize the notion of a Beurling prime system: an increasing sequence of
real numbers greater than 1 that generates "integers" through products.
-/

/--
A Beurling prime sequence is an increasing sequence of reals greater than 1.
-/
structure BeurlingSeq where
  /-- The sequence of "generalized primes" -/
  seq : ℕ → ℝ
  /-- All terms are greater than 1 -/
  gt_one : ∀ n, 1 < seq n
  /-- The sequence is strictly increasing -/
  strict_mono : StrictMono seq
  /-- The sequence is unbounded (tends to infinity) -/
  tendsto_top : Filter.Tendsto seq Filter.atTop Filter.atTop

/--
A finitely supported tuple of non-negative integers.
We represent this as a finite map ℕ →₀ ℕ (using Mathlib's Finsupp).
-/
abbrev Exponents := ℕ →₀ ℕ

/--
Given a Beurling sequence and exponents, compute the product ∏ᵢ aᵢ^{kᵢ}.
-/
noncomputable def BeurlingSeq.product (a : BeurlingSeq) (k : Exponents) : ℝ :=
  k.support.prod fun i => a.seq i ^ (k i)

/-
## The Gap Condition

The crucial condition: any two distinct products must differ by at least 1.
-/

/--
A Beurling sequence satisfies the gap condition if for every distinct pair of
finitely supported exponent tuples, the corresponding products differ by at least 1.
-/
def BeurlingSeq.hasGapCondition (a : BeurlingSeq) : Prop :=
  ∀ k l : Exponents, k ≠ l → |a.product k - a.product l| ≥ 1

/-
## The Counting Function

The counting function for a Beurling sequence: how many terms are ≤ x.
-/

/--
The counting function for a Beurling sequence: #{aᵢ ≤ x}.
For technical reasons we count indices n such that a(n) ≤ x.
-/
noncomputable def BeurlingSeq.countingFn (a : BeurlingSeq) (x : ℝ) : ℕ :=
  Finset.card (Finset.filter (fun n => a.seq n ≤ x) (Finset.range (Nat.floor x + 1)))

/-
## The Conjecture

Erdős Problem #951: The counting function of any Beurling sequence with the
gap condition is bounded by π(x), the prime counting function.
-/

/--
**Erdős Problem #951 (OPEN)**: If a Beurling sequence satisfies the gap condition
(distinct products differ by at least 1), then its counting function is at most π(x).

This conjecture is OPEN. No proof or counterexample is known.

The significance: this would show that the ordinary primes are "optimally dense"
among all multiplicatively well-separated sequences.
-/
axiom erdos_951_conjecture (a : BeurlingSeq) (h : a.hasGapCondition) :
    ∀ x : ℕ, a.countingFn x ≤ Nat.primeCounting x

/-
## Basic Properties

We verify some basic properties about Beurling sequences.
-/

/-- The empty exponent tuple gives product 1. -/
theorem BeurlingSeq.product_empty (a : BeurlingSeq) :
    a.product 0 = 1 := by
  simp [BeurlingSeq.product, Finsupp.support_zero]

/-- If k ≠ 0, then the product involves at least one term > 1. -/
theorem BeurlingSeq.product_pos (a : BeurlingSeq) (k : Exponents) :
    0 < a.product k := by
  unfold BeurlingSeq.product
  apply Finset.prod_pos
  intro i _
  apply rpow_pos_of_pos
  exact lt_trans zero_lt_one (a.gt_one i)

/-- With the gap condition, the product is ≥ 1 for any nonzero k. -/
theorem BeurlingSeq.product_ge_one (a : BeurlingSeq) (h : a.hasGapCondition) (k : Exponents)
    (hk : k ≠ 0) : a.product k ≥ 1 := by
  -- By the gap condition applied to k and 0
  have hgap := h k 0 hk
  simp only [BeurlingSeq.product_empty] at hgap
  -- |a.product k - 1| ≥ 1 and a.product k > 0 implies a.product k ≥ 1 or ≤ 0
  -- Since a.product k > 0, we need the first case
  have hpos := a.product_pos k
  cases' (abs_sub_ge_one_of_ne_one hpos.ne' hgap) with h1 h2
  · exact h1
  · linarith
    where
      abs_sub_ge_one_of_ne_one {r : ℝ} (hr : r ≠ 0) (h : |r - 1| ≥ 1) : r ≥ 1 ∨ r ≤ 0 := by
        cases' le_or_lt r 0 with h0 h0
        · exact Or.inr h0
        · cases' le_or_lt r 1 with h1 h1
          · -- r ∈ (0, 1], so |r - 1| = 1 - r ≥ 1 gives r ≤ 0, contradiction
            rw [abs_of_nonpos (sub_nonpos.mpr h1)] at h
            linarith
          · exact Or.inl (le_of_lt h1)

/-
## Examples and Observations

The primes themselves form a Beurling sequence with the gap condition.
-/

/--
The sequence of primes satisfies the gap condition: distinct products of primes
(i.e., distinct positive integers) differ by at least 1.

This is trivial since products of primes are positive integers, and distinct
positive integers differ by at least 1.
-/
theorem primes_have_gap_condition : True := trivial
  -- The actual statement would require defining the prime sequence as a BeurlingSeq
  -- and proving the gap condition, which follows from unique factorization.

/-
## Why This is Hard

The difficulty in Erdős #951 lies in understanding how the gap condition
constrains the density of the sequence.

Key observations:
1. The gap condition is a global constraint involving all products
2. Having more "primes" means more possible products, making it harder
   to maintain gaps
3. But how to quantify this trade-off optimally?

The conjecture suggests that primes are extremal: you cannot pack more
generalized primes than real primes while maintaining the gap condition.
-/

/--
A weaker form: if a satisfies the gap condition and has more "primes" than π,
we'd get a contradiction. This is precisely what the conjecture asserts.

Status: OPEN - no proof approach is known.
-/
axiom erdos_951_alternative : ∀ a : BeurlingSeq, a.hasGapCondition →
    ∃ C : ℝ, ∀ x : ℕ, (a.countingFn x : ℝ) ≤ C * Nat.primeCounting x

/-
## Summary

Erdős Problem #951 asks whether Beurling prime sequences with the gap condition
are necessarily sparser than the true primes.

**Formalized**:
- BeurlingSeq: an increasing unbounded sequence of reals > 1
- hasGapCondition: distinct products differ by ≥ 1
- The conjecture: countingFn ≤ primeCounting

**Status**: OPEN
- No proof or counterexample known
- The gap condition's effect on density is not well understood
- Related to primitive sequence theory and Beurling prime number theory

**Approach Ideas** (for future research):
1. Study examples of dense Beurling sequences and their product gaps
2. Connect to lattice-free sets and their density bounds
3. Investigate whether Beurling's PNT applies to give upper bounds
-/

theorem erdos_951_status : True := trivial

end Erdos951
