/**
 * Research Data Index
 *
 * Exports:
 * - researchListings: Lightweight metadata for ResearchPage gallery (small bundle)
 * - getResearchProblemAsync: Dynamic import for full problem data (lazy loaded)
 *
 * Note: research-listings.json is generated by scripts/research/build.ts
 * Run `pnpm research:build` to generate the data files.
 */

import type { ResearchListing, ResearchProblem } from '@/types/research'

// Import listings - generated by build script
// This import will fail if build hasn't run yet
import listingsData from './research-listings.json'

// Lightweight listings for ResearchPage - does not pull in full problem data
export const researchListings: ResearchListing[] = listingsData as ResearchListing[]

/**
 * Asynchronously load research problem data for a given slug.
 * This enables per-problem code splitting - only loads the requested problem.
 */
export async function getResearchProblemAsync(slug: string): Promise<ResearchProblem | undefined> {
  try {
    const module = await import(`./problems/${slug}.json`)
    return module.default as ResearchProblem
  } catch (e) {
    console.error(`Failed to load research problem: ${slug}`, e)
    return undefined
  }
}

/**
 * Get all research listings synchronously.
 * Use this for the gallery page.
 */
export function getResearchListings(): ResearchListing[] {
  return researchListings
}
