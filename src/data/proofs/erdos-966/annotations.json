[
  {
    "id": "ann-e966-header",
    "proofId": "erdos-966",
    "range": { "startLine": 1, "endLine": 29 },
    "type": "concept",
    "title": "Problem Overview",
    "content": "**Erdős Problem #966** asks a fascinating Ramsey-type question:\n\nGiven parameters k, r ≥ 2, can we find a set A ⊆ ℕ that:\n1. Contains NO arithmetic progression of length k+1\n2. Yet FORCES every r-coloring to have a monochromatic k-AP\n\n**Answer:** YES (Spencer, ~1975)\n\nThis bridges **additive combinatorics** (AP-free sets) with **Ramsey theory** (monochromatic structures).",
    "mathContext": "An arithmetic progression of length k is {a, a+d, a+2d, ..., a+(k-1)d}. It's non-trivial when d > 0.",
    "significance": "critical",
    "relatedConcepts": ["Arithmetic progressions", "Ramsey theory", "Van der Waerden theorem"]
  },
  {
    "id": "ann-e966-ap-def",
    "proofId": "erdos-966",
    "range": { "startLine": 47, "endLine": 53 },
    "type": "definition",
    "title": "Arithmetic Progression Definition",
    "content": "**arithmeticProgression a d k:**\n\nConstructs the finite set {a, a+d, a+2d, ..., a+(k-1)d}.\n\n**Implementation:**\n```lean\ndef arithmeticProgression (a d k : ℕ) : Finset ℕ :=\n  (Finset.range k).image (fun i => a + i * d)\n```\n\nThis maps indices 0, 1, ..., k-1 to the AP terms.",
    "mathContext": "Using Finset.range and image provides a clean, computable definition.",
    "significance": "key",
    "relatedConcepts": ["Finset", "Arithmetic sequences"]
  },
  {
    "id": "ann-e966-contains-ap",
    "proofId": "erdos-966",
    "range": { "startLine": 60, "endLine": 71 },
    "type": "definition",
    "title": "AP Containment and AP-Free Sets",
    "content": "**containsAPOfLength A k:**\n\nA set A contains a k-term AP if there exist a, d with d > 0 such that all elements a, a+d, ..., a+(k-1)d are in A.\n\n**APFreeOfLength A k:**\n\nA set is k-AP-free if it contains NO such progression.\n\nThese predicates capture the central constraint: avoiding long APs while allowing shorter ones.",
    "significance": "critical",
    "relatedConcepts": ["AP-free sets", "Szemerédi's theorem"]
  },
  {
    "id": "ann-e966-coloring",
    "proofId": "erdos-966",
    "range": { "startLine": 77, "endLine": 86 },
    "type": "definition",
    "title": "r-Colorings",
    "content": "**Coloring r:**\n\nAn r-coloring assigns each natural number a color from {0, 1, ..., r-1}.\n\n**colorClass A f c:**\n\nThe subset of A whose elements have color c under coloring f.\n\n```lean\ndef colorClass (A : Set ℕ) (f : Coloring r) (c : Fin r) : Set ℕ :=\n  {x ∈ A | f x = c}\n```",
    "mathContext": "Colorings partition a set into r disjoint color classes.",
    "significance": "key",
    "relatedConcepts": ["Partition", "Pigeonhole principle"]
  },
  {
    "id": "ann-e966-monochromatic",
    "proofId": "erdos-966",
    "range": { "startLine": 88, "endLine": 99 },
    "type": "definition",
    "title": "Monochromatic APs and Ramsey Property",
    "content": "**hasMonochromaticAP A r f k:**\n\nThere exists a color class (under coloring f) that contains a k-term AP.\n\n**forcesMonochromaticAP A r k:**\n\nEVERY r-coloring of A has a monochromatic k-term AP.\n\nThis is the \"Ramsey property\" - no matter how you color, you can't avoid the pattern.",
    "significance": "critical",
    "relatedConcepts": ["Ramsey theory", "Unavoidable patterns"]
  },
  {
    "id": "ann-e966-spencer-set",
    "proofId": "erdos-966",
    "range": { "startLine": 109, "endLine": 127 },
    "type": "axiom",
    "title": "Spencer's Set Construction",
    "content": "**SpencerSet k r:**\n\nThe witness set satisfying both properties simultaneously:\n1. **spencer_AP_free:** No (k+1)-term AP exists\n2. **spencer_forces_mono_AP:** Every r-coloring has a monochromatic k-AP\n\nThe actual construction is sophisticated - marked as `sorry` since the combinatorial details are beyond simple formalization.",
    "mathContext": "Spencer's construction uses probabilistic or algebraic methods to achieve both constraints.",
    "significance": "critical",
    "relatedConcepts": ["Probabilistic method", "Constructive combinatorics"]
  },
  {
    "id": "ann-e966-main-theorem",
    "proofId": "erdos-966",
    "range": { "startLine": 146, "endLine": 154 },
    "type": "theorem",
    "title": "Erdős Problem #966: SOLVED",
    "content": "**erdos_966:**\n\n```lean\ntheorem erdos_966 (k r : ℕ) (hk : k ≥ 2) (hr : r ≥ 2) :\n    ∃ A : Set ℕ,\n      APFreeOfLength A (k + 1) ∧\n      forcesMonochromaticAP A r k :=\n  spencer_theorem k r hk hr\n```\n\n**The answer is YES** for all k, r ≥ 2. Such sets exist!",
    "significance": "critical",
    "relatedConcepts": ["Existence theorem", "Ramsey theory"]
  },
  {
    "id": "ann-e966-vdw",
    "proofId": "erdos-966",
    "range": { "startLine": 163, "endLine": 189 },
    "type": "axiom",
    "title": "Van der Waerden Connection",
    "content": "**Van der Waerden's Theorem (1927):**\n\nFor any k, r, there exists N such that any r-coloring of {1, ..., N} contains a monochromatic k-term AP.\n\n**Van der Waerden Number W(k, r):**\nThe minimum such N.\n\n**Erdős 966 Refinement:**\nEven when restricted to (k+1)-AP-free sets, the Ramsey property persists for k-APs.",
    "mathContext": "Van der Waerden numbers grow extremely fast - W(3,3) is already unknown!",
    "significance": "key",
    "relatedConcepts": ["Van der Waerden theorem", "Ramsey numbers"]
  },
  {
    "id": "ann-e966-folkman",
    "proofId": "erdos-966",
    "range": { "startLine": 191, "endLine": 208 },
    "type": "concept",
    "title": "Connection to Erdős Problem #924",
    "content": "**Graph-Theoretic Analogue:**\n\nErdős Problem #924 asks: Does there exist a graph G with no (k+1)-clique, yet every r-coloring has a monochromatic k-clique?\n\n**Answer:** YES (Folkman's theorem)\n\nProblem #966 is the **arithmetic progression analogue**:\n- Graphs → Sets of integers\n- Cliques → Arithmetic progressions\n\nBoth have affirmative answers!",
    "significance": "key",
    "relatedConcepts": ["Folkman numbers", "Graph coloring", "Erdős #924"]
  },
  {
    "id": "ann-e966-cases",
    "proofId": "erdos-966",
    "range": { "startLine": 214, "endLine": 228 },
    "type": "theorem",
    "title": "Specific Instantiations",
    "content": "**case_k2_r2:**\nThere exists A with no 3-AP, but every 2-coloring has a monochromatic 2-AP.\n(Note: Any 2 distinct elements form a \"2-AP\", so this is nearly trivial.)\n\n**case_k3_r2:**\nThere exists A with no 4-AP, but every 2-coloring has a monochromatic 3-AP.\nThis is more interesting - avoiding 4-APs while forcing 3-APs in any 2-coloring.",
    "significance": "supporting",
    "relatedConcepts": ["Instantiation", "Concrete examples"]
  },
  {
    "id": "ann-e966-roth",
    "proofId": "erdos-966",
    "range": { "startLine": 238, "endLine": 254 },
    "type": "axiom",
    "title": "Roth's Theorem and Density",
    "content": "**Roth's Theorem (1953):**\n\nAny subset of ℕ with positive upper density contains a 3-term AP.\n\n**Implication for Spencer's Sets:**\n\nSince Spencer's sets avoid all sufficiently long APs, they must have **zero upper density**.\n\n```lean\naxiom spencer_zero_density (k r : ℕ) (hk : k ≥ 2) (hr : r ≥ 2) :\n    upperDensity (SpencerSet k r) = 0\n```",
    "mathContext": "Roth won the Fields Medal partly for this result. Szemerédi extended it to all k.",
    "significance": "key",
    "relatedConcepts": ["Roth's theorem", "Szemerédi's theorem", "Upper density"]
  },
  {
    "id": "ann-e966-singleton",
    "proofId": "erdos-966",
    "range": { "startLine": 260, "endLine": 269 },
    "type": "theorem",
    "title": "Singleton Sets are AP-Free",
    "content": "**singleton_AP_free:**\n\nAny singleton {n} is trivially k-AP-free for k ≥ 2.\n\n**Proof Idea:**\nA k-AP with d > 0 has at least 2 distinct elements: a and a+d. A singleton can't contain both.\n\nThis shows the base case: extreme AP-avoidance is easy (just use tiny sets).",
    "significance": "supporting",
    "relatedConcepts": ["Base cases", "Trivial instances"]
  },
  {
    "id": "ann-e966-ap-card",
    "proofId": "erdos-966",
    "range": { "startLine": 271, "endLine": 281 },
    "type": "theorem",
    "title": "AP Cardinality",
    "content": "**AP_card:**\n\nAn arithmetic progression {a, a+d, ..., a+(k-1)d} with d > 0 has exactly k elements.\n\n**Proof:**\nThe map i ↦ a + i·d is injective when d > 0 (different i give different values). So the image of {0, ..., k-1} has cardinality k.",
    "significance": "supporting",
    "relatedConcepts": ["Cardinality", "Injective functions"]
  },
  {
    "id": "ann-e966-summary",
    "proofId": "erdos-966",
    "range": { "startLine": 287, "endLine": 308 },
    "type": "theorem",
    "title": "Summary Theorem",
    "content": "**erdos_966_summary:**\n\nCombines all main results:\n1. Existence of the required set A\n2. A is (k+1)-AP-free\n3. A forces monochromatic k-APs in any r-coloring\n4. A has zero upper density\n\nThis captures the complete solution to Erdős Problem #966.",
    "significance": "key",
    "relatedConcepts": ["Summary", "Main results"]
  }
]
